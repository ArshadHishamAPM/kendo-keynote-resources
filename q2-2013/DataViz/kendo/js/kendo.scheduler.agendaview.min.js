/*
* Kendo UI Beta v2013.2.626 (http://kendoui.com)
* Copyright 2013 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.kendoui.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

("function"==typeof define&&define.amd?define:function(e,t){return t()})(["./kendo.scheduler.view.min"],function(){!function(e){var t=window.kendo,a=t.ui,n=".kendoAgendaView",s=e.extend;a.AgendaView=a.SchedulerView.extend({init:function(e,s){a.SchedulerView.fn.init.call(this,e,s),this.title=this.options.title,this.name=this.options.name,this._eventTemplate=t.template(this.options.eventTemplate),this._dateTemplate=t.template(this.options.eventDateTemplate),this._timeTemplate=t.template(this.options.eventTimeTemplate),this.element.on("mouseenter"+n,".k-scheduler-agenda .k-scheduler-content tr","_mouseenter").on("mouseleave"+n,".k-scheduler-agenda .k-scheduler-content tr","_mouseleave").on("click"+n,".k-scheduler-agenda .k-scheduler-content .k-link:has(.k-i-close)","_remove"),this._renderLayout(this.options.date)},_mouseenter:function(t){e(t.currentTarget).addClass("k-state-hover")},_mouseleave:function(t){e(t.currentTarget).removeClass("k-state-hover")},_remove:function(a){a.preventDefault(),this.trigger("remove",{uid:e(a.currentTarget).closest(".k-task").attr(t.attr("uid"))})},nextDate:function(){return t.date.nextDay(this.startDate())},startDate:function(){return this._startDate},endDate:function(){return this._endDate},previousDate:function(){return t.date.previousDay(this.startDate())},_renderLayout:function(e){this._startDate=e,this._endDate=t.date.addDays(e,7),this.createLayout(this._layout()),this.table.addClass("k-scheduler-agenda")},_layout:function(){return{columns:[{text:"Date",className:"k-scheduler-datecolumn"},{text:"Time",className:"k-scheduler-timecolumn"},{text:"Event"}]}},_tasks:function(e){var a,n,i,d,r,l,o,c=[];for(a=0;a<e.length;a++)if(n=e[a],i=n.start,d=n.end,n.isAllDay&&(d=t.date.nextDay(d)),r=Math.ceil((d-i)/t.date.MS_PER_DAY),n.isAllDay||1!==r||t.date.getDate(d).getTime()===t.date.getDate(i).getTime()||(r+=1),l=s({},n),l.startDate=t.date.getDate(i),c.push(l),r>1)for(l.end=t.date.nextDay(i),l.head=!0,o=1;r>o;o++)i=l.end,l=s({},n),l.start=i,l.startDate=t.date.getDate(i),l.end=t.date.nextDay(i),o==r-1?(l.end=new Date(l.start.getFullYear(),l.start.getMonth(),l.start.getDate(),d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()),l.tail=!0):(l.isAllDay=!0,l.middle=!0),l.end.getTime()<=this.endDate().getTime()&&c.push(l);return new t.data.Query(c).sort([{field:"start",dir:"asc"},{field:"end",dir:"asc"}]).groupBy({field:"startDate"}).toArray()},render:function(e){var a,n,i,d,r,l,o,c,u,h=this.content.find("table").empty();if(e.length>0){for(a=this._tasks(e),n=[],i=0;i<a.length;i++)for(d=a[i].value,r=a[i].items,l=t.date.isToday(d),o=0;o<r.length;o++)c=r[o],u=[],0===o&&u.push(t.format('<td class="k-scheduler-datecolumn{2}" rowspan="{0}">{1}</td>',r.length,this._dateTemplate({date:d}),i==a.length-1?" k-last":"")),c.format=c.head?"{0:t}":c.tail?"{1:t}":"{0:t}-{1:t}",c.resources=this.eventResources(c),u.push(t.format('<td class="k-scheduler-timecolumn"><div>{0}{1}{2}</div></td><td>{3}</td>',c.tail||c.middle?'<span class="k-icon k-i-arrow-w"></span>':"",this._timeTemplate(s({},c,{start:c.startTime||c.start,end:c.endTime||c.end})),c.head||c.middle?'<span class="k-icon k-i-arrow-e"></span>':"",this._eventTemplate(c))),n.push("<tr"+(l?' class="k-today">':">")+u.join("")+"</tr>");h.append(n.join(""))}this.refreshLayout()},destroy:function(){this.element&&this.element.off(n),a.SchedulerView.fn.destroy.call(this)},options:{title:"Agenda",name:"agenda",selectedDateFormat:"{0:D}-{1:D}",eventTemplate:'<div class="k-task" title="#:title#" data-#=kendo.ns#uid="#=uid#"># if (resources[0]) {#<span class="k-scheduler-mark" style="background-color:#=resources[0].color#"></span># } ## if (data.id && data.recurrenceId) { #<span class="k-icon k-i-exception"></span># } else if (data.recurrenceRule || data.recurrenceId) {#<span class="k-icon k-i-refresh"></span># } ##:title#<a href="\\#" class="k-link k-event-delete"><span class="k-icon k-i-close"></span></a></div>',eventTimeTemplate:"#if(data.isAllDay) {#all day#} else { ##=kendo.format(format, start, end)## } #",eventDateTemplate:'<strong class="k-scheduler-agendaday">#=kendo.toString(date, "dd")#</strong><em class="k-scheduler-agendaweek">#=kendo.toString(date,"dddd")#</em><span class="k-scheduler-agendadate">#=kendo.toString(date, "y")#</span>'}})}(window.kendo.jQuery)});