/*
* Kendo UI Complete v2013.1.702 (http://kendoui.com)
* Copyright 2013 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at
* https://www.kendoui.com/purchase/license-agreement/kendo-ui-complete-commercial.aspx
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
("function"==typeof define&&define.amd?define:function(e,t){return t()})(["./kendo.data.min","./kendo.mobile.application.min","./kendo.userevents.min"],function(){(function(e){function t(){return this.nodeType===i.TEXT_NODE&&this.nodeValue.match(L)}function l(e,t){t&&e.prepend('<span class="km-icon km-'+t+'"/>')}function o(e){l(e,_(e,"icon"))}function n(e){var o=e.parent(),n=e.add(o.children(a.roleSelector("detailbutton"))),r=o.contents().not(n).not(t);r.length||(e.addClass("km-listview-link").attr(a.attr("role"),"listview-link"),l(e,_(o,"icon")))}function r(e){if(e.children("input[type=checkbox],input[type=radio]").length){var t=e.parent();t.contents().not(e).not(function(){return 3==this.nodeType})[0]||e.addClass("km-listview-label")}}var a=window.kendo,i=window.Node,s=a.mobile,d=s.ui,c=a.data.DataSource,p=d.Widget,h=".km-list > li, > li:not(.km-group-container)",u=".km-listview-link, .km-listview-label",f=e.proxy,_=a.attrValue,m="km-group-title",g="km-state-active",v='<div class="'+m+'"><div class="km-text"></div></div>',k=a.template('<li><div class="'+m+'"><div class="km-text">#= this.headerTemplate(data) #</div></div><ul>#= kendo.render(this.template, data.items)#</ul></li>'),S='<div class="km-listview-wrapper" />',T=a.template('<form class="km-filter-form"><div class="km-filter-wrap"><input type="search" placeholder="#=placeholder#"/><a href="\\#" class="km-filter-reset" title="Clear"><span class="km-icon km-clear"></span><span class="km-text">Clear</span></a></div></form>'),w=".kendoMobileListView",y="lastPageReached",b="click",H="change",x="progress",C="function",L=/^\s+$/,M=/button/,I=p.extend({init:function(e,t){var l=this;p.fn.init.call(l,e,t),e=l.element,t=l.options,t.scrollTreshold&&(t.scrollThreshold=t.scrollTreshold),e.on("down",u,"_highlight").on("move up cancel",u,"_dim"),l._userEvents=new a.UserEvents(e,{filter:h,allowSelection:!0,tap:function(e){l._click(e)}}),e.css("-ms-touch-action","auto"),e.wrap(S),l.wrapper=l.element.parent(),l._footer(),l._dataSource(),l._bindScroller(),l._fixHeaders(),l._filterable(),t.dataSource&&l.options.autoBind?l.dataSource.fetch():l._style(),a.notify(l,d)},events:[b,"dataBound",y],options:{name:"ListView",style:"",type:"flat",autoBind:!0,fixedHeaders:!1,template:"#:data#",headerTemplate:'<span class="km-text">#:value#</span>',appendOnRefresh:!1,loadMore:!1,loadMoreText:"Press to load more",endlessScroll:!1,scrollThreshold:30,pullToRefresh:!1,pullTemplate:"Pull to refresh",releaseTemplate:"Release to refresh",refreshTemplate:"Refreshing",pullOffset:140,filterable:!1},setOptions:function(e){p.fn.setOptions.call(this,e)},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.options.autoBind&&e.fetch()},destroy:function(){var e=this;p.fn.destroy.call(e),e._unbindDataSource(),e.stopEndlessScrolling(),e.stopLoadMore(),a.destroy(e.element),e._userEvents.destroy(),delete e.element,delete e.wrapper,delete e._userEvents},refresh:function(t){t=t||{};var l,o,n,r,i,c,p=this,h=p.element,u=p.options,f=p.dataSource,_=f.view(),m=p.loading,g="html",v=t.action,k=t.items,S="group"===u.type,T=0;if("itemchange"===v)return r=k[0],c=h.find("[data-"+a.ns+"uid="+r.uid+"]"),c[0]&&(i=e(p.template(r)),c.replaceWith(i),p.trigger("itemChange",{item:i,data:r,ns:d})),p._style(),undefined;if("add"===v&&!S){for(n=k.length;n>T;T++)i=e(p.template(k[T])),i.appendTo(h),s.init(i);return p._style(),undefined}if("remove"!==v||S)p.template||p._templates(),p._cacheDataItems(_),p.trigger("dataBinding"),o=f.group(),o&&o[0]?(u.type="group",l=a.render(p.groupTemplate,_)):l=a.render(p.template,_),m?g="append":u.appendOnRefresh&&!p._filter&&(g="prepend"),p._filter=!1,l=e(l),"html"===g&&a.destroy(h.children()),h[g](l),s.init(l),m&&(p.loading=!1,p._calcThreshold(),p._toggleLoader(!1)),u.pullToRefresh&&p._scroller().pullHandled(),p._hideLoading(),p._shouldFixHeaders(),p._style(),p._invalidateLoadMore(),p.trigger("dataBound",{ns:d});else for(n=k.length;n>T;T++)h.find("[data-"+a.ns+"uid="+k[T].uid+"]").remove()},_invalidateLoadMore:function(){var e=this,t=e.options,l=e.dataSource,o=e._stopLoadMore&&(!l.total()||l.page()<l.totalPages());o&&(t.endlessScroll&&e.initEndlessScrolling(),t.loadMore&&e.initLoadMore())},_cacheDataItems:function(e){var t,l=this;l.element[0].firstChild||(l._firstOrigin=l._first=e[0],l._last=e[e.length-1]),l._pulled&&(t=e[0],l._pulled=!1,t&&(l._first=t)),l.loading&&(t=e[e.length-1],t&&(l._last=t))},items:function(){return"group"===this.options.type?this.element.find(".km-list").children():this.element.children()},initEndlessScrolling:function(){this._stopLoadMore=!1,this._scroller().setOptions({resize:this._scrollerResize,scroll:this._scrollerScroll})},stopEndlessScrolling:function(){var e=this,t=e._scroller();t&&e._loadIcon&&(e.loading=!1,e._stopLoadMore=!0,e._loadIcon.parent().hide(),t.unbind("resize",e._scrollerResize).unbind("scroll",e._scrollerScroll),e.trigger(y))},initLoadMore:function(){var e=this;e._stopLoadMore=!1,e._loadButton.autoApplyNS().on("up",f(e._nextPage,e))},stopLoadMore:function(){var e=this;e._loadButton&&(e._stopLoadMore=!0,e.loading=!1,e._loadButton.kendoDestroy().parent().hide(),e.trigger(y))},_dim:function(e){this._toggle(e,!1)},_highlight:function(e){this._toggle(e,!0)},_toggle:function(t,l){if(!(t.which>1)){var o=e(t.currentTarget),n=o.parent(),r=_(o,"role")||"",a=!r.match(M),i=t.isDefaultPrevented();a&&n.toggleClass(g,l&&!i)}},_unbindDataSource:function(){var e=this;e.dataSource.unbind(H,e._refreshHandler).unbind(x,e._progressHandler)},_dataSource:function(){var e=this,t=e.options;e.dataSource&&e._refreshHandler?e._unbindDataSource():(e._refreshHandler=f(e.refresh,e),e._progressHandler=f(e._showLoading,e)),e.dataSource=c.create(t.dataSource).bind(H,e._refreshHandler),t.pullToRefresh||t.loadMore||t.endlessScroll||e.dataSource.bind(x,e._progressHandler)},_fixHeader:function(t){if(this.fixedHeaders){var l,o,n,r=0,a=this,i=a._scroller(),s=t.scrollTop,d=a.headers;do{if(l=d[r++],!l){n=e("<div />");break}o=l.offset,n=l.header}while(o>s);a.currentHeader!=r&&(i.fixedContainer.html(n.clone()),a.currentHeader=r)}},_shouldFixHeaders:function(){this.fixedHeaders="group"===this.options.type&&this.options.fixedHeaders},_cacheHeaders:function(){var t=this,l=[];t.fixedHeaders&&(t.element.find("."+m).each(function(t,o){o=e(o),l.unshift({offset:o.position().top,header:o})}),t.headers=l,t._fixHeader({scrollTop:0}))},_fixHeaders:function(){var e=this,t=e._scroller(),l=function(){e._cacheHeaders()};e._shouldFixHeaders(),e.container().bind("show",l),t&&(a.onResize(l),t.bind("scroll",function(t){e._fixHeader(t)}))},_bindScroller:function(){var e=this,t=e.options,l=e._scroller();l&&(t.pullToRefresh&&l.setOptions({pullToRefresh:!0,pull:function(){var l=t.pullParameters,o={page:1};l&&(o=l.call(e,e._first)),e._pulled=!0,e.dataSource.read(o)},pullTemplate:t.pullTemplate,releaseTemplate:t.releaseTemplate,refreshTemplate:t.refreshTemplate}),t.endlessScroll&&(e._scrollHeight=l.element.height(),e._scrollerResize=function(){e._scrollHeight=l.element.height(),e._calcThreshold()},e._scrollerScroll=function(t){!e.loading&&t.scrollTop+e._scrollHeight>e._threshold&&e._nextPage()},e.initEndlessScrolling()))},_calcThreshold:function(){var e=this,t=e._scroller();t&&(e._threshold=t.scrollHeight()-e.options.scrollThreshold)},_nextPage:function(){var e,t=this,l=t.options,o=l.endlessScrollParameters||l.loadMoreParameters;t.loading=!0,t._toggleLoader(!0),o&&(e=o.call(t,t._firstOrigin,t._last)),t.dataSource.next(e)||(t.stopLoadMore(),t.stopEndlessScrolling())},_templates:function(){var e=this,t=e.options.template,l=e.options.headerTemplate,o=' data-uid="#=data.uid || ""#"',n={},r={};typeof t===C&&(n.template=t,t="#=this.template(data)#"),r.template=e.template=f(a.template("<li"+o+">"+t+"</li>"),n),typeof l===C&&(r._headerTemplate=l,l="#=this._headerTemplate(data)#"),r.headerTemplate=a.template(l),e.groupTemplate=f(k,r)},_click:function(t){if(!(t.event.which>1||t.isDefaultPrevented())){var l,o=this,n=t.target,r=e(t.event.target),i=r.closest(a.roleSelector("button","detailbutton","backbutton")),s=a.widgetInstance(i,d),c=n.attr(a.attr("uid"));c&&(l=o.dataSource.getByUid(c)),o.trigger(b,{target:r,item:n,dataItem:l,button:s})&&t.preventDefault()}},_style:function(){var t=this,l=t.options,o="group"===l.type,n=t.element,r="inset"===l.style;n.addClass("km-listview").toggleClass("km-list",!o).toggleClass("km-listinset",!o&&r).toggleClass("km-listgroup",o&&!r).toggleClass("km-listgroupinset",o&&r),o&&(n.children().children("ul").addClass("km-list"),n.children("li").each(function(){var t=e(this),l=t.contents().first();t.addClass("km-group-container"),l.is("ul")||l.is("div."+m)||l.wrap(v)})),t._enhanceItems(),n.parents(".km-listview")[0]||n.closest(".km-content").toggleClass("km-insetcontent",r),t._cacheHeaders()},_enhanceItems:function(){this.items().each(function(){var t,l=e(this),a=!1;l.children().each(function(){t=e(this),t.is("a")?(n(t),a=!0):t.is("label")&&(r(t),a=!0)}),a||o(l)})},_footer:function(){var t,l=this,o=l.options,n=o.loadMore;(n||o.endlessScroll)&&(l._loadIcon=e('<span style="display:none" class="km-icon"></span>'),t=e('<span class="km-load-more"></span>').append(l._loadIcon),n&&(l._loadButton=e('<button class="km-load km-button">'+o.loadMoreText+"</button>"),l.initLoadMore(),t.append(l._loadButton)),l.wrapper.append(t))},_toggleLoader:function(e){var t=this,l=t._loadIcon,o=t._loadButton;o&&o.toggle(!e),e?(l.parent().addClass("km-scroller-refresh"),l.css("display","block")):(l.hide(),l.parent().removeClass("km-scroller-refresh"))},_scroller:function(){var e,t=this;return t._scrollerInstance||(e=t.view(),t._scrollerInstance=e&&e.scroller),t._scrollerInstance},_showLoading:function(){var e=this.view();e&&e.loader&&e.loader.show()},_hideLoading:function(){var e=this.view();e&&e.loader&&e.loader.hide()},_filterable:function(){var e=this,t=e.options.filterable,l="change paste";t&&(e.element.before(T({placeholder:t.placeholder||"Search..."})),t.autoFilter!==!1&&(l+=" keyup"),e.searchInput=e.wrapper.find("input[type=search]").closest("form").on("submit"+w,function(e){e.preventDefault()}).end().on("focus"+w,function(){e._oldFilter=e.searchInput.val()}).on(l.split(" ").join(w+" ")+w,f(e._filterChange,e)),e.clearButton=e.wrapper.find(".km-filter-reset").on(b,f(e._clearFilter,e)).hide())},_search:function(e){this._filter=!0,this.clearButton[e?"show":"hide"](),this.dataSource.filter(e)},_filterChange:function(e){var t=this;"paste"==e.type&&t.options.filterable.autoFilter!==!1?setTimeout(function(){t._applyFilter()},1):t._applyFilter()},_applyFilter:function(){var e=this,t=e.options.filterable,l=e.searchInput.val(),o=l.length?{field:t.field,operator:t.operator||"startsWith",ignoreCase:t.ignoreCase,value:l}:null;l!==e._oldFilter&&(e._oldFilter=l,e._search(o))},_clearFilter:function(e){this.searchInput.val(""),this._search(null),e.preventDefault()}});d.plugin(I)})(window.kendo.jQuery)});