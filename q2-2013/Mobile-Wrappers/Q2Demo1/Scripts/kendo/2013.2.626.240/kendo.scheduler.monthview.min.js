/*
* Kendo UI Beta v2013.2.626 (http://kendoui.com)
* Copyright 2013 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.kendoui.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

("function"==typeof define&&define.amd?define:function(t,e){return e()})(["./kendo.scheduler.view.min"],function(){!function(t){function e(){return i.culture().calendars.standard}function n(t){for(var n=e(),a=n.firstDay,s=new Date(t.getFullYear(),t.getMonth(),0,t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds());s.getDay()!=a;)i.date.setTime(s,-1*c);return s}function a(t,e,n){var a,i=e.getTime(),s=n.getTime();return a=t.getTime(),a>=i&&s>=a}var i=window.kendo,s=i.ui,o=s.SchedulerView,r=".kendoMonthView",d=t.extend,l=t.proxy,h=i.date.getDate,c=i.date.MS_PER_DAY,u=i.template('<span class="k-link k-nav-day">#=kendo.toString(date, "dd")#</span>'),f='<div class="k-event" data-#=ns#uid="#=uid#" data#=ns#-start-end-idx="#=startIndex#-#=endIndex#"#if (resources[0]) { #style="background-color:#=resources[0].color #"#}#><span class="k-event-actions"># if(data.tail || data.middle) {#<span class="k-icon k-i-arrow-w"></span>#}## if(data.id && data.recurrenceId) {#<span class="k-icon k-i-exception"></span># } else if(data.recurrenceRule || data.recurrenceId) {#<span class="k-icon k-i-refresh"></span>#}#</span>{0}<span class="k-event-actions">#if (showDelete) {#<a href="\\#" class="k-link k-event-delete"><span class="k-icon k-i-close"></span></a>#}## if(data.head || data.middle) {#<span class="k-icon k-i-arrow-e"></span>#}#</span></div>',p=i.template('<div title="#=title#"><dl><dd>${title}</dd></dl></div>'),v=i.template('<div style="width:#=width#px;left:#=left#px;top:#=top#px" class="k-more-events k-button" data#=ns#-start-end-idx=#=start#-#=end#><span>...</span></div>');s.MonthView=o.extend({init:function(t,e){var n=this;o.fn.init.call(n,t,e),n.title=n.name=n.options.title,n._templates(),n._editable(),n._renderLayout(n.options.date)},_templates:function(){var t=this.options,e=d({},i.Template,t.templateSettings);this.eventTemplate=this._eventTmpl(t.eventTemplate),this.dayTemplate=i.template(t.dayTemplate,e)},dateForTitle:function(){return i.format(this.options.selectedDateFormat,this._firstDayOfMonth,this._lastDayOfMonth)},nextDate:function(){return i.date.nextDay(this._lastDayOfMonth)},previousDate:function(){return i.date.previousDay(this._firstDayOfMonth)},startDate:function(){return this._startDate},endDate:function(){return this._endDate},_renderLayout:function(e){var a=this;this._firstDayOfMonth=i.date.firstDayOfMonth(e),this._lastDayOfMonth=i.date.lastDayOfMonth(e),this._startDate=n(e),this.createLayout(this._layout()),this.table.addClass("k-scheduler-monthview"),this._content(),this.refreshLayout(),this.content.on("click"+r,".k-nav-day",function(e){var n=t(e.currentTarget).closest("td");a.trigger("navigate",{view:"day",date:a._rangeToDates(n).start})}),this.content.on("click"+r,".k-more-events",function(e){var n=o.rangeIndex(t(e.currentTarget)).start,s=i.date.addDays(a.startDate(),n);a.trigger("navigate",{view:"day",date:s})})},_editable:function(){var e=this;e.options.editable&&(e.element.on("click"+r,".k-scheduler-monthview .k-event a:has(.k-i-close)",function(n){e.trigger("remove",{uid:t(this).closest(".k-event").attr(i.attr("uid"))}),n.preventDefault()}),e.options.editable.create!==!1&&e.element.on("dblclick"+r,".k-scheduler-monthview .k-scheduler-content td",function(n){var a=t(this);e.trigger("add",{eventInfo:d({isAllDay:!0},e._rangeToDates(a))}),n.preventDefault()}),e.options.editable.update!==!1&&e.element.on("dblclick"+r,".k-scheduler-monthview .k-event",function(n){e.trigger("edit",{uid:t(this).closest(".k-event").attr(i.attr("uid"))}),n.preventDefault()}))},_rangeToDates:function(t){var e=this.content.find("table td").index(t),n=i.date.addDays(this.startDate(),e);return n?{start:n,end:new Date(n)}:null},_content:function(){for(var t=this.startDate(),e=this._firstDayOfMonth,n=this._lastDayOfMonth,a=0,s=42,o=7,r=this.dayTemplate,d="",l={},c=[t],u="<tbody><tr>";s>a;a++)a>0&&0===a%o&&(c.push(t),u+="</tr><tr>"),d="",i.date.isToday(t)&&(d+="k-today"),i.date.isInDateRange(t,e,n)||(d+=" k-other-month"),u+="<td ",""!==d&&(u+='class="'+d+'"'),u+=">",u+=r({date:t}),u+="</td>",l[h(t).getTime()]=a,t=i.date.nextDay(t);u+="</tr></tbody>",this._slotIndices=l,this._weekStartDates=c,this._endDate=i.date.previousDay(t),this.content.find("table").html(u)},_layout:function(){var n=e().days.names;return{columns:t.map(n,function(t){return{text:t}})}},_eventTmpl:function(t){var e,n=this.options,a=d({},i.Template,n.templateSettings),s=a.paramName,o="",r=typeof t,h={storage:{},count:0};return"function"===r?(h.storage["tmpl"+h.count]=t,o+="#=this.tmpl"+h.count+"("+s+")#",h.count++):"string"===r&&(o+=t),e=i.template(i.format(f,o),a),h.count>0&&(e=l(e,h.storage)),e},_createEventElement:function(e){var n=this.options;return e.showDelete=n.editable&&n.editable.destroy!==!1,e.ns=i.ns,e.resources=this.eventResources(e),t(this.eventTemplate(e))},_isInDateSlot:function(t){var e=this.startDate(),n=new Date(this.endDate().getTime()+c-1);return a(t.start,e,n)||a(t.end,e,n)||a(e,t.start,t.end)||a(n,t.start,t.end)},_slotIndex:function(t){return this._slotIndices[h(t).getTime()]},_calculateAllDayEventWidth:function(t,e,n){var a,i=0,s=e==n?"clientWidth":"offsetWidth";for(a=e;n>=a;a++)i+=t[a][s];return i},_positionEvent:function(e,n,a,s){var r,d,l,h,c,u,f=this.options.eventHeight,p=e[a],m=p.eventCount,g=o.collidingHorizontallyEvents(this.content.find(".k-event"),a,s).add(n),y=a!==s?5:4,D=o.createRows(g);for(r=0,d=Math.min(D.length,m);d>r;r++)for(l=D[r].events,h=p.top+r*f+3*r+"px",c=0,u=l.length;u>c;c++)l[c].style.top=h;if(D.length>m){if(p.more)return;p.more=n=t(v({ns:i.ns,start:a,end:s,width:p.clientWidth-2,left:p.left,top:p.top+m*f+3*m}))}else n[0].style.width=this._calculateAllDayEventWidth(e,a,s)-y+"px",n[0].style.left=p.left+"px",n[0].style.height=f+"px";this.content[0].appendChild(n[0])},_splitEvents:function(t){var e,n,s,o,r,l,u,f,p=[],v=this._weekStartDates;for(e=0,r=t.length;r>e;e++){for(n=d({},t[e]),l=0,u=v.length;u>l;l++)o=v[l],s=Math.ceil((n.end-n.start)/c),a(o,n.start,n.end)&&s>=1&&(h(n.start).getTime()===h(o).getTime()?s>1&&(n.tail?(n.tail=!1,n.middle=!0):n.head=!0):(f=d({},n),n.tail?(n.tail=!1,f.middle=!0):f.head=!0,f.start=n.start,f.end=i.date.previousDay(o),p.push(f),n.start=o,n.head=!1,h(n.end).getTime()>h(this.endDate()).getTime()+c-1?n.middle=!0:n.tail=!0,n.end=n.end));p.push(n)}return p},render:function(t){var e,n,a,s,o,r,d,l,h,c,u,f;for(this.content.children(".k-event,.k-more-events").remove(),s=this.content[0].getElementsByTagName("td"),o=this.options.eventHeight,r=this.content[0].scrollTop,d=[],n=0,a=s.length;a>n;n++)l=s[n],h=l.clientHeight,c=l.firstChild.offsetHeight+3,d.push({clientWidth:l.clientWidth,clientHeight:h,offsetWidth:l.offsetWidth,top:l.offsetTop+c+r,left:l.offsetLeft+2,eventCount:Math.floor((h-c)/(o+3)),element:l});for(t=new i.data.Query(this._splitEvents(t)).sort([{field:"start",dir:"asc"},{field:"end",dir:"desc"}]).toArray(),n=0,a=t.length;a>n;n++)e=t[n],this._isInDateSlot(e)&&(u=this._slotIndex(e.start),f=this._slotIndex(e.end),0>u&&f>-1&&(u=f),0>u&&(u=0),(0>f||!f)&&(f=d.length-1),e.startIndex=u,e.endIndex=f,this._positionEvent(d,this._createEventElement(e),u,f))},destroy:function(){this.table&&this.table.removeClass("k-scheduler-monthview"),this.content&&this.content.off(r),this.element&&this.element.off(r),o.fn.destroy.call(this)},events:["remove","add","edit","navigate"],options:{title:"Month",name:"month",eventHeight:25,editable:!0,selectedDateFormat:"{0:y}",dayTemplate:u,eventTemplate:p}})}(window.kendo.jQuery)});